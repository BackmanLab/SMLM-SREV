# Program: overlapfilter_continue.in
# Author: Rivaan Kakkaramadam
# Description: The purpose of this simulation is to generate the number of immobilized objects (SREV nucleosomes + colocalized labels) 
# after LAMMPS' overlapping filter process & iteration of dye diffusivity simulation. This number is critical in calculating
# the input parameters needed to simulate the diffusion of mobile labels at a consistent temperature between iterations.

units lj
atom_style ellipsoid
region box block 0 10 0 10 0 10    # box is overwritten by reading dump file
create_box 3 box                   # Three atom types: 1) chrm 2) mobile labels 3) immobilized/colocalized labels

# read in the SREV config file

read_dump config-relaxed-5.dump 0 x y z add yes box yes

# read in dye label input file which contains most current info on which fluorophores should stay chromatin-bound and which should be mobile

include post-immobil-input.in

set type 1 mass 3.0
set type 2 mass 1.0
set type 3 mass 1.0

set type 1 shape 1.0 1.0 0.5 # define SREV nucleosome ellipsoid dimensions
set type 2 shape 1.0 1.0 1.0 # define BrdU mobile fluorophore ellipsoid (sphere) dimensions
set type 3 shape 1.0 1.0 1.0 # define BrdU colocalized fluorophore ellipsoid (sphere) dimensions

group ellip type 1
group spher type 2
group coloc type 3

group immob type 1 3 # defining a group of "immobilized particles" (this is SREV nucleosomes and SREV-colocalized fluorophores)
group allLabel type 2 3

set group ellip quat/random 87287

comm_style tiled
comm_modify cutoff 3.0 mode single vel yes

balance 1.1 rcb

velocity spher create 2.50 87287
velocity immob zero linear #zero the starting velocity of all immobilized particles
velocity immob zero angular

fix freeze immob setforce 0.0 0.0 0.0 #zero the forces that would act on the immobilized particles

pair_style gayberne 1.0 1.0 1.0 3.0 # used for specifying SREV-dye label & dye label-dye label interaction potentials
pair_coeff 1 1  1.0 1.0   1.7 1.7 3.4   0.0 0.0 0.0
pair_coeff 1 2  1.0 1.0   1.7 1.7 3.4   0.0 0.0 0.0
pair_coeff 2 2  1.0 1.0   1.7 1.7 1.7   0.0 0.0 0.0
pair_coeff 2 3  1.0 1.0   1.7 1.7 1.7   0.0 0.0 0.0
pair_coeff 3 3  1.0 1.0   1.7 1.7 1.7   0.0 0.0 0.0

# define how particles' list of neighbors are constructed -> important for simulation machinations

neighbor 0.7 bin
neigh_modify every 20 delay 0 check no

# below lines define temp out of whole system

fix 1 all nvt temp .0458736637 .0458736637 1.0
fix 2 all balance 500 1.1 rcb

delete_atoms overlap 0.98 ellip ellip # some SREV configs have overlaps despite MD repulsion sim; need to remove overlaps before label sim proceeds

# below computes are for computing temp of different sets of objects for review of sim dynamics

compute         rot all temp/asphere
compute         0 all property/atom quatw quati quatj quatk shapex shapey shapez

compute		mTempRegularTemp spher temp
compute		mTAT spher temp/asphere

timestep 0.0005

thermo_style custom step temp c_mTempRegularTemp c_mTAT epair emol etotal press # outputs thermodynamic variables useful for tracking simulation progress

thermo 100

dump           1 immob custom 100 dump.immob id type x y z c_0[*] # output an edited dump file containing all immobilized particles that omits any overlapping SREV nucleosomes
dump_modify    1 sort id

dump           2 ellip custom 100 dump.ellipsoid id type x y z c_0[*] # output an edited dump file containing all SREV nucleosomes that omits any overlapping SREV nucleosomes
dump_modify    2 sort id

run 0 # technically this simulation runs for 0 timesteps; all that's needed is for the simulation to run the above commands once, which will occur at least at "timestep 0"
